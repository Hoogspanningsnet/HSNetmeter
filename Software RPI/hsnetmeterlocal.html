<html>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://code.highcharts.com/stock/highstock.js"></script>
	<script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
	<meta charset="utf-8" />
	<link rel="icon" href="favicon.ico">
	<title>Netfrequentie.nl - Grid frequency graph</title>
</head>
<body>
	<div id="container" style="width:100%; height:100%; margin: 0 auto;"></div>
	<script>
		$(document).ready(function () { 
			Highcharts.setOptions({
				global: {
					useUTC: false
				}
			});
			var chart = new Highcharts.stockChart('container', {
				navigator: {
					enabled: true,
					yAxis: {
						plotLines: [{
							color: '#ccd6eb',
							value: 50,
							width: 1,
						}],
					},
				},
				xAxis: {
					type: 'datetime',
					ordinal: false,
				},
				yAxis: {
					labels: {
						format: '{value:.3f}',
					},
					plotBands:[ 
						{ // mark the lower problem zone
							color: '#FF3333',
							from: 45.000,
							to: 49.800,
						},
						{ // mark the upward dispatch high regulation zone
							color: '#ff6600',
							from: 49.800,
							to: 49.850,
						},
						{ // mark the upward dispatch highmid regulation zone
							color: '#ff9900',
							from: 49.850,
							to: 49.900,
						},
						{ // mark the upward dispatch lowmid regulation zone
							color: '#ffff00',
							from: 49.900,
							to: 49.950,
						},
						{ // mark the upward dispatch low regulation zone
							color: '#ccff66',
							from: 49.950,
							to: 49.980,
						},
						{ // mark the deadband
							color: '#99ff66',
							from: 49.980,
							to: 50.020,
						},
						{ // mark the donwqard dispatch low regulation zone
							color: '#ccff66',
							from: 50.020,
							to: 50.050,
						},
						{ // mark the upward dispatch lowmid regulation zone
							color: '#ffff00',
							from: 50.050,
							to: 50.100,
						},
						{ // mark the upward dispatch highmid regulation zone
							color: '#ff9900',
							from: 50.100,
							to: 50.150,
						},
						{ // mark the upward dispatch high regulation zone
							color: '#ff6600',
							from: 50.150,
							to: 50.200,
						},
						{ // mark the upper problem zone
							color: '#FF3333',
							from: 50.200,
							to: 55.000,
						},
					],
				},
				tooltip: {
					pointFormat: 'Frequency: {point.y:.3f} Hz',
				},
				series: [{
					name: 'Frequency',
					turboThreshold: 500,
					data: [],
					lineWidth: 2
				}]
			});

			var offset = new Date().getTimezoneOffset();
			console.log('offset: ',offset);
			var socket = new WebSocket("ws://192.168.2.2:6789/");
			socket.onopen = function(event) { console.log("connected"); };
			socket.onmessage = function(event) {
				var data = JSON.parse(event.data);
				var series = chart.series[0];
				var shift = series.options.data.length > 1000;
				series.addPoint([ (data.tick) * 1000, data.freq ], true, shift, false);
			};
			socket.onerror = function (event) { console.log("disconnected"); };
		});
	</script>
</body>
</html>
